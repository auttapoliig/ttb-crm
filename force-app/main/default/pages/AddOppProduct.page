<apex:page showChat="false" tabStyle="Opportunity" standardStylesheets="true" lightningStylesheets="true" standardController="Opportunity"
    extensions="SLOSAddproductExtension" docType="html-5.0" action="{!updateProductGroup}">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w4.org/1999/xlink">

    <head>
        <apex:includeScript value="{!URLFOR($Resource.TMBjquery, '/TMBassets/jquery/jquery-1.11.2.min.js')}" />
        <apex:stylesheet value="{!URLFOR($Resource.sfLightningVF, 'assets/styles/salesforce-lightning-design-system-vf.css')}" />

        <apex:stylesheet value="{!URLFOR($Resource.bootstrapsf1, 'dist/css/bootstrap-namespaced.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.boostrapex)}" />
        <apex:stylesheet value="{!URLFOR($Resource.AccountPlanEditTable)}" />
        <apex:includescript value="{!$Resource.AccountPlan_JqueryScript}" />
        <apex:includescript value="{!$Resource.AccountPlan_Bootstrap}" />
        <apex:includeScript value="{!$Resource.AccountPlan_Mustache}" />
        <apex:includeScript value="/support/console/48.0/integration.js" />
        <apex:stylesheet value="{!URLFOR($Resource.SLOS)}" />
        <style>
            td {
                padding: 5px;
            }

            .balloon-helptext-imgclass:hover {
                background-image: url(/img/help/helpOrbs.gif);
                background-repeat: no-repeat;
                width: 16px;
                height: 15px;
                background-position: right;
            }

            .balloon-helptext-imgclass {
                background-image: url(/img/help/helpOrbs.gif);
                background-repeat: no-repeat;
                width: 16px;
                height: 15px;
            }

            .page1 .glyphicon-question-sign {
                top: -5px;
                font-size: 16px;
            }

            .page1 .bootstrap-sf1,
            .page1 .slds-form-element__label {
                float: left;
            }

            .page1 .slds-form-element__control {
                clear: both;
            }
        </style>
    </head>

    <body>
        <apex:outputPanel id="thePanel">
            <apex:form styleclass="slds-form--stacked" id="frm" style="width:100% !important;">
                <!-- Ajax  -->
                <apex:actionStatus id="status" onstart="ShowSpin()" onstop="HideSpin()"> </apex:actionStatus>
                <apex:actionFunction name="loading" status="status" reRender="panelMessage" />
                <apex:actionFunction name="chgProduct" action="{!displayProduct}" status="status" reRender="sfproductPanel,panelMessage"
                />
                <apex:actionFunction name="validateYear" action="{!validateYear}" reRender="panelMessage" />
                <apex:actionFunction name="clearMessage" reRender="panelMessage" />


                <div class="slds">

                    <div id="spin" style="display:none;" class="slds-spinner_container">
                        <div class="slds-spinner--brand slds-spinner slds-spinner--large" aria-hidden="false" role="alert">
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </div>
                    <!--HEADER-->
                    <div class="slds-page-header" role="banner">
                        <div class="slds-grid">
                            <div class="slds-col">
                                <div class="slds-media">

                                    <div class="slds-media__figure">
                                        <span class="slds-icon__container slds-icon__container--circle slds-icon-standard-product">
                                            <span class="bootstrap-sf1">
                                                <span class="glyphicon glyphicon-book" aria-hidden="true"></span>
                                            </span>
                                        </span>
                                    </div>

                                    <div class="slds-media__body">
                                        <p class="slds-text-heading--label">SLS</p>
                                        <h1 class="slds-text-heading--small">
                                            Add Product
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--END HEADER-->
                    <!--CONTAINER-->
                    <apex:outputPanel id="panelMessage">

                        <apex:pageMessages escape="false"></apex:pageMessages>

                    </apex:outputPanel>
                    <apex:outputPanel id="page1" rendered="{!if(page=='page1',true,false)}" styleClass="page1">
                        <div class="slds-grid slds-grid--align-center slds-m-around--medium ">

                            <div class="slds-size--1-of-2">

                                <div class="slds-box--x-small slds-m-around--x-small">
                                    <fieldset class="slds-box slds-theme--default ">
                                        <legend id="Submit" class=" slds-p-vertical--small slds-text-heading--label">
                                            Add Product
                                        </legend>
                                        <div class="slds-form-element ">
                                            <label class="slds-form-element__label">Host System</label>
                                            <div class=" bootstrap-sf1">
                                                <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                    data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Host_Name__c.inlineHelpText}"
                                                />
                                            </div>
                                            <div class="slds-form-element__control">
                                                <apex:outputPanel rendered="{!if ( oppty.Host_System__c!='',true,false)}">
                                                    <apex:outputField value="{!hostTemp.Host_Name__c}" rendered="{!isHasProduct}" />
                                                    <div style="display: {!if(!isHasProduct,'block;','none')}">
                                                        <apex:inputField value="{!hostTemp.Host_Name__c}" onchange="loading()" styleClass="slds-input" />
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!if (oppty.Host_System__c=='',true,false)}">
                                                    <apex:inputField value="{!hostTemp.Host_Name__c}" onchange="loading()" styleClass="slds-input" />
                                                </apex:outputPanel>
                                            </div>
                                        </div>

                                        <div class="slds-form-element slds-m-top--medium">
                                            <label class="slds-form-element__label" for="accountName">Product Group</label>
                                            <div class=" bootstrap-sf1">
                                                <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                    data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Host_Product_Group__c.inlineHelpText}"
                                                />
                                            </div>
                                            <div class="slds-form-element__control">
                                                <apex:outputPanel rendered="{!if (oppty.Host_Product_Group__c!='',true,false)}">

                                                    <apex:outputField value="{!hostTemp.Host_Product_Group__c}" rendered="{!isHasProduct}" />
                                                    <div style="display: {!if(!isHasProduct,'block;','none')}">
                                                        <apex:inputField value="{!hostTemp.Host_Product_Group__c}" onchange="loading()" styleClass="slds-input" />
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!if (oppty.Host_Product_Group__c=='',true,false)}">
                                                    <apex:inputField value="{!hostTemp.Host_Product_Group__c}" onchange="loading()" styleClass="slds-input" />
                                                </apex:outputPanel>
                                            </div>
                                        </div>

                                        <div class="slds-form-element slds-m-top--medium">
                                            <label class="slds-form-element__label" for="accountName">Product Program</label>
                                            <div class=" bootstrap-sf1">
                                                <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                    data-placement="bottom" title="{!$ObjectType.Opportunity.Fields.Product_Program__c.inlineHelpText}"
                                                />
                                            </div>
                                            <div class="slds-form-element__control">
                                                <apex:inputField value="{!hostTemp.Product_Program__c}" onchange="loading()" styleClass="slds-input" />
                                            </div>
                                        </div>

                                        <div class="slds-form-element slds-m-top--medium">
                                            <label class="slds-form-element__label" for="accountName">Credit Facility</label>
                                            <div class=" bootstrap-sf1">
                                                <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                    data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Host_Prod_Name_Credit_Facility__c.inlineHelpText}"
                                                />
                                            </div>
                                            <div class="slds-form-element__control">
                                                <apex:inputField value="{!hostTemp.Host_Prod_Name_Credit_Facility__c}" onchange="chgProduct()" styleClass="slds-input" />
                                            </div>
                                        </div>

                                        <div class="slds-form-element slds-m-top--medium">
                                            <label class="slds-form-element__label" for="accountName">SE Product</label>
                                            <div class=" bootstrap-sf1">
                                                <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                    data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Salesforce_Product__c.inlineHelpText}"
                                                />
                                            </div>
                                            <div class="slds-form-element__control">
                                                <apex:outputPanel id="sfproductPanel">
                                                    {!sfproduct}
                                                    <div style="display:none">
                                                        <apex:inputField value="{!hostTemp.Salesforce_Product__c}" />
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                        </div>

                                    </fieldset>
                                </div>
                            </div>

                        </div>
                        <div class="slds-text-align--center slds-m-around--medium">
                            <div class="slds-form-element">
                                <apex:commandButton value="Add" action="{!addProduct}" status="status" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                />&nbsp;
                                <apex:commandButton value="Cancel" onclick="cancel();return false;" status="status" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                    oncomplete="HideSpin();" />

                            </div>
                        </div>
                    </apex:outputPanel>

                    <!--================================================Page 2============================================================-->


                    <apex:actionFunction name="redirectDeskTop" action="{!redirectDeskTop}" />

                    <apex:outputPanel id="page2" rendered="{!if(page=='page2',true,false)}">
                        <!--{!if(page=='page2',true,false)}-->
                        <div class="slds-size--2-of-2">

                            <div class="slds-box--x-small slds-m-around--x-small">
                                <fieldset class="slds-theme--default ">

                                    <div class="slds-text-align--center">
                                        <div class="slds-form-element">
                                            <apex:commandButton value="Save" action="{!dosave}" status="status" reRender="panelMessage,script_block" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                            /> &nbsp;
                                            <apex:commandButton value="Cancel" onclick="cancel();return false;" oncomplete="HideSpin();" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                                status="status" reRender="panelMessage" />&nbsp;
                                            <!-- <apex:commandButton value="Breakdown" action="{!openBreakdown}" status="status" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                                oncomplete="showSpin()" reRender="panelMessage" rendered="{!isNotSF1}" /> -->

                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div id="actFrm" aria-labelledby="newaccountform" class="slds-m-around--medium">
                            <fieldset class="slds-box slds-theme--default ">
                                <legend id="Submit" class=" slds-p-vertical--small slds-text-heading--label">
                                    Product
                                </legend>

                                <div class="slds-text-align--center slds-m-around--medium">

                                </div>
                                <div class="slds-form-element ">
                                    <div class="slds-form-element " style="">
                                        <table class="slds-table--bordered slds-table--cell-buffer slds-max-medium-table--stacked-horizontal">
                                            <thead>
                                                <tr class="slds-text-title--caps slds-section-title--divider" style="Background-color: #c9e4fc;">
                                                    <th scope="col" width="100px">
                                                        <div title="Product Group">Product Group </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.Opportunity.Fields.Host_Product_Group__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col" width="100px">
                                                        <div title="Product Program">Product
                                                            <br /> Program</div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.Opportunity.Fields.Product_Program__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col" width="100px">
                                                        <div title="Credit Facility">Credit
                                                            <br /> Facility</div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Host_Prod_Name_Credit_Facility__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col" width="100px">
                                                        <div title="Product">Product </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.Host_Product_Mapping__c.Fields.Salesforce_Product__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Vol./Limit (THB)">Request Amt./Vol.
                                                            <br/>(THB) </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.UnitPrice.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Units of Acct./Limit">Approved Amount
                                                            <br />(THB)</div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Approved_Amount__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Total Vol./Limit Amount">Actual Amount
                                                            <br />(THB)</div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Actual_Amount__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="text-center" title="Tenor (Years)">Tenor
                                                            <br />(Years) </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Tenor_Years__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Probability by RM (%)">Probability by
                                                            <br /> RM (%)
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Deal_Probability__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="TMB Account No">TMB Account ID</div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.TMB_Account_ID__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>

                                                </tr>
                                            </thead>
                                            <tbody>


                                                <tr>
                                                    <td>
                                                        <apex:outputField value="{!hostTemp.Host_Product_Group__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputField value="{!hostTemp.Product_Program__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputField value="{!hostTemp.Host_Prod_Name_Credit_Facility__c}" />
                                                    </td>

                                                    <td data-label="Product">
                                                        {!sfproduct}
                                                    </td>
                                                    <td data-label="Vol./Limit (THB)">
                                                        <apex:inputField value="{!oppProd.UnitPrice}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>

                                                    <td data-label="Approved Amount (THB)">

                                                        <apex:outputText value="{0, number, ###,##0.00}" styleClass="slds-text-align--right">
                                                            <apex:param value="{!oppProd.Approved_Amount__c}" />
                                                        </apex:outputText>
                                                    </td>
                                                    <td data-label="Actual Amount (THB)">
                                                        <apex:outputText value="{0, number, ###,##0.00}" styleClass="slds-text-align--right">
                                                            <apex:param value="{!oppProd.Actual_Amount__c}" />
                                                        </apex:outputText>

                                                    </td>

                                                    <td data-label="Tenor (Years)">
                                                        <apex:inputField value="{!oppProd.Tenor_Years__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="Probability by RM (%)">
                                                        <apex:inputField value="{!oppProd.Deal_Probability__c}" style="" styleClass="slds-select" />
                                                    </td>
                                                    <td data-label="TMB Account No">
                                                        <apex:inputField value="{!oppProd.Notional_Amount__c}" style="" styleClass="slds-input slds-text-align--right" rendered="{! !if(contains(oppProd.opportunity.recordtype.name,'SE'),true,false)}"
                                                        />
                                                        <apex:inputField value="{!oppProd.TMB_Account_ID__c}" style="" styleClass="slds-input slds-text-align--right" rendered="{!if(contains(oppProd.opportunity.recordtype.name,'SE'),true,false)}"
                                                        />
                                                    </td>
                                                </tr>


                                            </tbody>


                                            <!-- <thead style="margin-top:60px;">
                                                <tr class="slds-text-title--caps slds-section-title--divider" style="Background-color: #c9e4fc;">
                                                    <th scope="col">
                                                        <div title="">&nbsp; </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Type of Income">Type of
                                                            <br /> Income
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Type_of_Reference__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Recurring or One-off">Recurring or
                                                            <br /> One-off
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Recurring_Type__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Frequency ">Frequency
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Frequency__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Expected Start Month/Year ">Expected Start
                                                            <br /> Month/Year
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.RevisedStartMonth__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="% Expected Utz./ Year">% Expected
                                                            <br />Utz./ Year </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Expected_Util_Year_NI__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Expected Utz. (Outs. Vol) ">Expected
                                                            <br /> Utz. (Outs. Vol) </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Expected_Utilization_Vol_NI__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Expected Margin (%)">Expected
                                                            <br /> Margin (%) </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Expected_NIM__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="This Year Expected Revenue">This Year
                                                            <br /> Expected
                                                            <br />Revenue
                                                            <span class="requiredStar">&nbsp;**</span>
                                                        </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.This_Year_Expected_NI__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                    <th scope="col">
                                                        <div title="Full Deal Expected Revenue">Full Deal
                                                            <br />Expected
                                                            <br />Revenue </div>
                                                        <div class=" bootstrap-sf1">
                                                            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-delay='{"show":"0", "hide":"100"}' data-animation="false"
                                                                data-placement="bottom" title="{!$ObjectType.OpportunityLineItem.Fields.Expected_Revenue__c.inlineHelpText}"
                                                            />
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>


                                                <tr>
                                                    <td data-label="Product">
                                                        <div>NI</div>

                                                    </td>
                                                    <td data-label="NI-Type of Income">
                                                        <apex:inputField value="{!oppProd.Type_Of_Reference__c}" style="" styleClass="slds-select" />
                                                    </td>
                                                    <td data-label="NI-Recurring or one-off">
                                                        <apex:inputField value="{!oppProd.Recurring_Type__c}" style="" styleClass="slds-select" onchange="changeRecurring('ni',this.value);"
                                                        />
                                                    </td>
                                                    <td data-label="NI-Frequency">
                                                        <apex:inputField value="{!oppProd.Frequency__c}" style="" styleClass="slds-select" id="nifrequency" />
                                                    </td>

                                                    <td data-label="NI-Expected Start Month/Year">

                                                        <apex:inputfield value="{!oppProd.RevisedStartMonth__c}" style="" styleClass="month slds-select" />
                                                        <br/>
                                                        <apex:inputfield value="{!oppProd.RevisedStartYear__c}" style="" styleClass="year slds-select" onchange="changeYear()" id="nistartyear"
                                                        />

                                                    </td>
                                                    <td data-label="NI-% Expected Utz./ Year">
                                                        <apex:inputField value="{!oppProd.Expected_Util_Year_NI__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="NI-Expected Utz. (Outs. Vol)" Class="slds-text-align--right">
                                                        <apex:outputText value="{0, number, ###,##0.00}" styleClass="slds-text-align--right">
                                                            <apex:param value="{!oppProd.Unitprice * oppProd.Quantity * (oppProd.Expected_Util_Year_NI__c/100)}" />
                                                        </apex:outputText>
                                                    </td>
                                                    <td data-label="NI-Expected Margin (%)">
                                                        <apex:inputField value="{!oppProd.Expected_NIM__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="NI-This Year Expected Revenue">
                                                        <apex:inputField value="{!oppProd.This_Year_Expected_NI__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="NI-Full Deal Expected Revene">
                                                        <apex:inputField value="{!oppProd.Expected_Revenue__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td data-label="Fee-Product">
                                                        <strong>Fee</strong>
                                                    </td>
                                                    <td data-label="Fee-Type of Income">
                                                        <apex:inputField value="{!oppProd.Type_Of_Reference_Fee__c}" style="" styleClass="slds-select" />
                                                    </td>
                                                    <td data-label="Fee-Recurring or one-off">
                                                        <apex:inputField value="{!oppProd.Recurring_Type_Fee__c}" style="" styleClass="slds-select" onchange="changeRecurring('fee',this.value);"
                                                        />
                                                    </td>
                                                    <td data-label="Fee-Frequency">
                                                        <apex:inputField value="{!oppProd.FrequencyFee__c}" style="" styleClass="slds-select" id="feefrequency" />
                                                    </td>
                                                    <td data-label="Fee-Expected Start Month/Year">
                                                        <apex:inputfield value="{!oppProd.RevisedStartMonthFee__c}" style="" styleClass="month slds-select" />
                                                        <br/>
                                                        <apex:inputfield value="{!oppProd.RevisedStartYearFee__c}" style="" styleClass="year slds-select" onchange="changeYear()"
                                                            id="feestartyear" />
                                                    </td>
                                                    <td data-label="Fee-% Expected Utz./ Year">
                                                        <apex:inputField value="{!oppProd.Expected_Util_Year_Fee__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="Fee-Expected Utz. (Outs. Vol)" Class="slds-text-align--right">
                                                        <apex:outputText value="{0, number, ###,##0.00}" styleClass="slds-text-align--right">
                                                            <apex:param value="{!oppProd.Unitprice * oppProd.Quantity * (oppProd.Expected_Util_Year_Fee__c/100)}" />
                                                        </apex:outputText>
                                                    </td>
                                                    <td data-label="Fee-Expected Margin (%)">
                                                        <apex:inputField value="{!oppProd.Expected_Fee_Rate__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="Fee-This Year Expected Revenue">
                                                        <apex:inputField value="{!oppProd.This_Year_Expected_Fee__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                    <td data-label="Fee-Full Deal Expected Revene">
                                                        <apex:inputField value="{!oppProd.Expected_Revenue_Fee__c}" style="" styleClass="slds-input slds-text-align--right" />
                                                    </td>
                                                </tr>


                                            </tbody> -->



                                        </table>


                                    </div>


                                </div>
                                <div class="slds-form-element slds-m-vertical--small">
                                    <label style="float:left;" class="slds-p-around--small slds-form-element__label slds-text-title--caps" for="accountName">Description</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!oppProd.Description}" style="width: 50%;height:60px" styleClass="slds-input desc" />
                                    </div>

                                    <br/>
                                    <font color="red">{!remark}</font>

                                </div>

                            </fieldset>
                        </div>

                        <div class="slds-text-align--center slds-m-vertical--x-large">
                            <div class="slds-form-element">
                                <apex:commandButton value="Save" action="{!dosave}" status="status" reRender="panelMessage,script_block" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                /> &nbsp;
                                <apex:commandButton value="Cancel" onclick="cancel();return false;" oncomplete="HideSpin();" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                    status="status" reRender="panelMessage" />&nbsp;
                                <!-- <apex:commandButton value="Breakdown" action="{!openBreakdown}" status="status" styleClass="slds-button slds-button--neutral uiButton forceActionButton"
                                    oncomplete="showSpin()" reRender="panelMessage" rendered="{!isNotSF1}" /> -->

                            </div>
                        </div>
                    </apex:outputPanel>


                    <!--END CONTAINER-->


                </div>
            </apex:form>
        </apex:outputPanel>
        <div class="bootstrap-sf1">
            <div class="modal fade modal-fullscreen force-fullscreen" id="frmModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true" style="margin-bottom: 30px;margin-top: 45px;">
                <div class="modal-dialog" style="width:90%;height:95%; margin:0 auto;">
                    <div class="modal-content" style="width:100%;height:95%;">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">&nbsp;</h4>
                        </div>
                        <div class="modal-body">
                            <iframe id="modalIframe" src="#" width="100%" height="400px" frameborder="0" allowtransparency="true"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <apex:outPutPanel layout="block" id="script_block">
            <script>
                var toggle = "{!toggleScript}";
                var _maintab;
                var _subtab;
                var isComplete = "{!iscomplete}";
                // var inconsole = sforce.console.isInConsole();
                var inconsole = false;
                var $j = jQuery.noConflict();

                $j(document).ready(function () {
                    // if (inconsole) {
                    //     _maintab = sforce.console.getEnclosingPrimaryTabId(mainTab);

                    // }

                });


                // console.log('isConsole : ' + inconsole + ' isComplete :' + isComplete + ' toggle : ' + toggle);
                if (inconsole == true && isComplete == 'true' && toggle == 'true') {
                    // sforce.console.getFocusedPrimaryTabId(showTabId);

                } else if (inconsole == false && isComplete == 'true' && toggle == 'true') {
                    afterSave(isComplete, toggle);
                }

                var showTabId = function showTabId(result) {
                    var tabId = result.id;
                    ShowSpin();
                    // sforce.console.refreshPrimaryTabById(tabId, true, refreshSuccess);
                    sforce.console.refreshPrimaryTabById(tabId, false);

                };
                var refreshSuccess = function refreshSuccess(result) {
                    if (result.success == true) {
                        setTimeout(function () {
                            sforce.console.getEnclosingTabId(closeSubtab);
                        }, 1500);
                    }
                };
                var closeSubtab = function closeSubtab(result) {
                    //Now that we have the tab ID, we can close it
                    var tabId = result.id;
                    sforce.console.closeTab(tabId);
                };

                var subtab = function subtab(result) {
                    //Now that we have the primary tab ID, we can close it
                    _subtab = result.id;
                };
                var mainTab = function mainTab(result) {
                    _maintab = result.id;
                };

            </script>
        </apex:outPutPanel>
    </body>

    </html>
    <script>
        var _maintab;
        var $j = jQuery.noConflict();
        function ShowSpin() {
            $j('#spin').show();
        }
        function HideSpin() {
            $j('#spin').hide();
        }

        function setTitle() {
            sforce.console.setTabTitle('Add Product');
        }
        function closeTab() {
            //First find the ID of the current tab to close it
            sforce.console.getEnclosingTabId(closeSubtab);
            // return false;
        }
        var closeSubtab = function closeSubtab(result) {
            //Now that we have the tab ID, we can close it
            var tabId = result.id;
            sforce.console.closeTab(tabId);
        };
        var setvar = function setvar(result) {
            _maintab = result.id;
            // console.log(_maintab);
        };

        $j(document).ready(function () {

            var theme = '{!$User.UIThemeDisplayed}';
            if (theme != 'Theme4t') {
                sforce.console.getEnclosingPrimaryTabId(setvar);
            }
            $j('[data-toggle="tooltip"]').tooltip();
            $j('.tooltip-inner').css('background-color', '#fff1de !important');
            setTitle();
            $j('#modalIframe').attr('src', '');
            $j('#blockframe').attr('src', '/apex/SLOSPrescreenContain?id={!oppty.id}');


            // if (sforce.console.isInConsole()) {
            //     $j('#breakdownButton').css('display', '');
            // } else if (theme == 'Theme4t') {
            //     $j('#breakdownButton').css('display', 'none');
            // } else {
            //     $j('#breakdownButton').css('display', '');
            // }

        });

        $j('#frmModel').on('show.bs.modal', function () {
            $j(this).find('.modal-body').css({
                // 'max-height':'800px'
            });
        });

        $j('#frmModel').on('hidden.bs.modal', function (e) {
            $j('#modalIframe').attr('src', '');
            $j('#blockframe').attr('src', '/apex/SLOSPrescreenContain?id={!oppty.id}');
            chkProductGrp();
        });

        function changeRecurring(type, value) {
            if (type == 'ni' && value == 'One-Off') {
                $j('[id$=nifrequency]').val('');
            } else if (type == 'fee' && value == 'One-Off') {
                $j('[id$=feefrequency]').val('');
            }
        }

        function changeYear() {
            if (($j('[id$=nistartyear]').val() != '{!thisYear}') || ($j('[id$=feestartyear]').val() != '{!thisYear}')) {
                validateYear();
            } else {
                clearMessage();
            }
        }
        function cancel() {
            ShowSpin();
            var theme = '{!$User.UIThemeDisplayed}';
            if (theme == 'Theme4u') {
                refreshTab();
            } else {
                sforce.one.navigateToSObject('{!oppty.Id}');
            }
        }

        function afterSave(iscomplete, toggle) {

            // console.log(iscomplete);
            if (iscomplete == 'true') {
                // console.log('last1:');
                ShowSpin();
                var theme = '{!$User.UIThemeDisplayed}'
                if (theme == 'Theme4u') {
                    refreshTab();
                } else {
                    sforce.one.navigateToSObject('{!oppty.Id}');
                }
            }
        }
        function refreshTab() {
            sforce.one.navigateToURL('/one/one.app#' + btoa(JSON.stringify({
                "componentDef": "c:workspaceAPIforVF",
                "attributes": {
                    "action": 'closeAndRefresh',
                    "recordId": '{!oppty.Id}',
                    "uuid": 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    }),
                }
            })), true);
        }

    </script>
</apex:page>
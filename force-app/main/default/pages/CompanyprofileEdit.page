<apex:page standardController="AcctPlanCompanyProfile__c" showHeader="{! !isConsoleMode}" extensions="CompanyProfilesCreationEx"  docType="html"  showChat="false" sidebar="false" applyBodyTag="false">
<head>
        <title>Company Profile</title>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Keattisak Chinburarat" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <!-- Static Resource -->
        <!--<apex:stylesheet value="{!URLFOR($Resource.bootstrapsf1, 'dist/css/bootstrap.min.css')}"/>  -->
        <apex:stylesheet value="{!URLFOR($Resource.bootstrapsf1, 'dist/css/bootstrap-namespaced.css')}"/>
        <!--[if lt IE 9]><script src="../dist/js/ie8-responsive-file-warning.js"></script><![endif]-->
        
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <apex:includeScript value="{!$Resource.AccountPlan_HTML5shiv}"/>
          <apex:includeScript value="{!$Resource.AccountPlan_Respond}"/>
        <![endif]-->        
        
        <apex:stylesheet value="{!$Resource.AccountPlanMaster}" />
        <style>
        
        .bootstrap-sf1 .year-form{
            width:120px;
            height:70px;
        }
        .dateOnlyInput .dateFormat {
            position: relative;
            right:0;
            
        }
        
        </style>  
    </head>

    <body>
            <apex:actionstatus id="status">
                                                    <apex:facet name="start">
                                                        <div class='overlay' style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.75; z-index: 1000; background-color: #ededed;">
                                                            &nbsp;
                                                        </div>
                                                        <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 50%">
                                                            <img src="/img/loading32.gif" />
                                                        </div>
                                                    </apex:facet>
                          </apex:actionstatus>
                                                            
            <div class="bootstrap-sf1">
                 <div id="responseErrors"> 
                 </div>
                 <apex:form styleClass="form-horizontal">
                     <apex:pageBlock id="pgBlock"  > 
                         
                         <apex:outputPanel id="statusMessage">
            <apex:pageMessages ></apex:pageMessages>
        </apex:outputPanel>
                    <fieldset>
                        <legend>Company Profile </legend>
                    </fieldset> 
                         <div class="form-group">
                                <div style="text-align: center;">
                 <apex:pageBlockButtons location="both" style="float:left;margin-left:150px;" >
                            <apex:commandButton value="Save" action="{!dosave}" 
                            styleclass="btn btn-success" 
                            rerender="statusMessage" status="status"  
                            rendered="{! !isDisabled&&isHasPermission}" />
                            <apex:commandButton value="Cancel" action="{!cancel}" styleclass="btn btn-success" 
                            onclick="if(!confirm('Are you sure you want to exit this screen without saving?')) return false;" />   
                        </apex:pageBlockButtons>
                                </div>
                            </div> 
                        
                        <header class="navbar navbar-default navbar-branded" role="banner" style="display:{! if(isDisabled,'none','grid')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%;">
                                <div class="navbar-header " style="float:left;">                    
                                    <a data-toggle="collapse" aria-expanded="true"  href="#collapse1" class="navbar-brand navbar-foundation-logo">
                                        General Information
                                    </a>
                                </div>                    
                            </div>
                        </header>
                        <div class="card collapse in panel-collapse" id="collapse1" style="display:{! if(isDisabled,'none','grid')};">            
                            <div class="card-detail" >
                            
                            <!--  Section 1 -->
                            <fieldset>                        
                                                                                   
                                <div class="row">
                                
                                <apex:PageBlock mode="edit" id="groupprofileblock">   
                        <apex:PageBlockSection columns="2"  id="theSection" >
                          
                              
                                 <apex:selectList value="{!companyprofile.Year__c}" 
                                 multiselect="false" size="1"
                                        styleClass="form-control year-form {!if(companyprofile.Year__c ==null,'danger','')} " 
                             rendered="{!isNew}" 
                             required="{!isNew}"
                             onchange="checkIshasValue(this);"
                             
                                 >
                                                    <apex:selectOptions value="{!fiscalYear}" />
                                                 </apex:selectList>
                                        
                             <apex:outputfield value="{!companyprofile.Year__c}" styleClass="form-control outputfield" rendered="{! !isNew}"  />  
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                   <apex:outputfield value="{!companyprofile.OwnerID}" styleClass="form-control outputfield"  />  
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                 
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                  <apex:outputfield value="{!companyprofile.Status__c}" styleClass="form-control outputfield" />  
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem> 
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                            <apex:outputfield value="{!companyprofile.AccountName__c}"    />
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                            <apex:inputField value="{!companyprofile.Company_Industry_Info__c}" styleClass="lookup form-control"  /> 
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                            <apex:inputField value="{!companyprofile.Business_Code__c  }" styleClass="form-control"  /> 
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                            <apex:inputField value="{!companyprofile.SubIndustry__c}" styleClass="form-control"   /> 
                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                             <apex:inputField value="{!companyprofile.EstablishedSince__c}" styleClass="form-control"   /> 
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                  
                             <apex:inputField value="{!companyprofile.CustomerSince__c}" styleClass="form-control"   /> 
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                  <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                   <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                             <apex:inputField value="{!companyprofile.NoOfEmployee__c }" styleClass="form-control"   />
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                   <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                   
                              <apex:inputField value="{!companyprofile.Parent_Company_Info__c}" styleClass="lookup form-control"   />
                               <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                             <!--<apex:outputfield value="{!companyprofile.Parent_Company_Name__c}"   />    
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem> 
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>-->
                              <apex:inputField value="{!companyprofile.Parent_Industry_Info__c}" styleClass="lookup form-control"   /> 
                                   <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                               <apex:inputField value="{!companyprofile.UltimateCompany__c }" styleClass="form-control"   /> 
                                 <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>    
                            </apex:PageBlockSection>
                               
                        <apex:PageBlockSection columns="1"  >
                            <apex:PageBlockSectionItem >
                                <apex:outputLabel value="Business Information"/>
                                <apex:inputField value="{!companyprofile.Other_Information__c }" label="Business Information" styleClass="form-control "  
                          id="otherinformation"  html-placeholder="businessinformation" />
                            </apex:PageBlockSectionItem>   
                          
                              
                             
                         </apex:PageBlockSection>

                         <apex:PageBlockSection columns="1"  >
                            <apex:PageBlockSectionItem rendered="{!companyprofile.ShareholdingStructure__c==null}" >
                                <div class="text-center" style="">
                                <p id='CreditfacilityDomesticNotify' class='bg-danger text-center' style='float:left;width:600px;padding: 8px;border: 1px solid #E28888;margin-left:18.2%;'>
                                    {!msgShareholding}
                                   </p>
                                   </div>
                                </apex:PageBlockSectionItem>   
                              <apex:inputField value="{!companyprofile.ShareholdingStructure__c }" styleClass="form-control "  
                              id="shareholding"  html-placeholder="Username" />
                                  
                                 
                             </apex:PageBlockSection>
                              
                        </apex:PageBlock>
                                  
                                </div>                              
                                                        
                            </fieldset>
                        </div>
                        </div>
                        <!-- /Section 1 --> 
                        
                        <!-- Section 2 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{! if(isDisabled,'none','grid')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%;">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse2" class="navbar-brand navbar-foundation-logo collapsed">
                                       Customer Business Flow / Inter-company flow/ Group Transactional Flow
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse2" style="display:{! if(isDisabled,'none','grid')};">            
                            <div class="card-detail" >
                            
                                <fieldset>
                                      
                                    <div class="row">                                      
                                        <apex:PageBlock mode="view" id="flowBlock">                                     
                                            <apex:PageBlockSection columns="1" id="businessflowSection">
                                                <apex:inputfield value="{!companyprofile.BusinessFlow__c}" />
                                            </apex:PageBlockSection>                                        
                                        </apex:PageBlock>    
                                    </div>                                      
                                    
                                </fieldset>
                            
                            </div>
                        </div>  
                        <!-- /Section 2 -->     

                        <!-- Section 3 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{! if(isDisabled,'none','grid')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%;">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse3" class="navbar-brand navbar-foundation-logo collapsed">
                                     Customer's Revenue Contribution / EBITDA Contribution
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse3" style="display:{! if(isDisabled,'none','grid')};">            
                            <div class="card-detail" >
                                 <fieldset>
                                    <!-- <div class="row">
                                        <div class="col-sm-12 col-md-6  col-lg-6">
                                            <div class="form-group">
                                                <label for="CompanyRevenueContributionType__c" class="col-lg-6 col-md-6  control-label">{!$ObjectType.CompanyProfile__c.fields.CompanyRevenueContributionType__c.label} :</label>
                                                <div class="col-lg-6 col-md-6 outputText">
                                                <apex:inputField value="{!CompanyProfile.CompanyRevenueContributionType__c}" styleClass="form-control" id="CompanyRevenueContributionType__c" /> -->
                                                    <!-- <apex:outputField value="{!CompanyProfile.CompanyRevenueContributionType__c}" styleClass="form-control" id="CompanyRevenueContributionType__c" /> -->        
                                                <!-- </div>
                                            </div>
                                        </div> -->  
                                    <div class="row" style="padding-bottom: 3px;"> 
                                        <div class="col-sm-12 col-md-9 col-lg-9" >      
                                              <a href="#" class="btn  btn-success" data-toggle="collapse" aria-expanded="true" id="contributeUI" style="float:left;">Add / Edit Revenue Contribution</a>                                            
                                         <div id="mandatoryedittable" style="margin-right:50px;">
                                            
                                        </div>
                                                    
                                        </div> 
                                                   
                                    </div>                                        
                                    <!-- /div>  -->
                                    <!-- related List Of  -->
                                    <table class="table table-striped table-hover " id ="contributetable">
                                        <thead>
                                            <tr>
                                                 <th customAttribute="product">Customer's Revenue Contribution Type
                                                     <span class="glyphicon glyphicon-question-sign"
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanContribution__c .Fields.RevenueContributionType__c.inlineHelpText}" />       
                                                 
                                                    
                                                    </th>
                                                 <th>Item Name
                                                     <span class="glyphicon glyphicon-question-sign" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="Item of Business Unit" />
                                                    </th>
                                                 <th>Revenue Contribution (%)
                                                                           <span class="glyphicon glyphicon-question-sign" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanContribution__c .Fields.RevenueContributionType__c.inlineHelpText}" />       
                            
                                                                           
                                                                           </th>
                                                 <th>EBITDA Contribution (%)
                                                     <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanContribution__c.Fields.RevenueContributionPercent__c.inlineHelpText}" />       
                                                         
                                                    
                                                    </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                                               
                                       </tbody>
                                    </table>
                                    
                                    
                                    
                                    <!-- start: Revenue Contribution by Buyer Type/ Segment /Distribution channel -->
                                    <div class="row" style="margin-top:30px;">
                                        &nbsp;
                                    </div>
                                    
                                                    <div class="row" style="padding-bottom: 3px;"> 
                                        <div class="col-sm-12 col-md-6 col-lg-6">      
                                              <a href="#" class="btn  btn-success" data-toggle="collapse" aria-expanded="true" id="distributionUI">Add / Edit Revenue Contribution channel</a>                                            
                                        </div>                                       
                                    </div>   
                                     <div class="=row">
                                        <h3 class="text-primary">Revenue Contribution by Buyer Type/ Segment /Distribution channel</h3>
                                        <table class="table table-striped table-hover " id="distributiontable">
                                              <thead>
                                                 <tr>                                                
                                                  <th rowspan="2">Buyer Type
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="Buyer {!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.DataType__c.inlineHelpText}" />       
                                                          
                                                  
                                                  </th>
                                                  <th rowspan="2">CCY
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.CCY__c.inlineHelpText}" />       
                                                          
                                                  </th>
                                                  <th rowspan="2">Country
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Country__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th rowspan="2">%
                                                      <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Percent__c.inlineHelpText}" />       
                                    
                                                      </th>
                                                  <th rowspan="2">Estimate No. of Buyers
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.EstimateNo__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th rowspan="2">Method of Collection
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Method__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th colspan="2">Credit Term</th>
                                                </tr>
                                                <tr>
                                                  <th>From (Days)
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.FromDays__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th>To (Days)
                                                     <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.ToDays__c.inlineHelpText}" />       
                                    
                                                     </th>
                                                </tr>
                                              </thead>
                                              <tbody>      

                                                
                                                
                                                                                            
                                                                                                
                                              </tbody>
                                        </table>                                      
                                    </div>  
                                    
                                    <div class="row" style="padding-bottom: 3px;margin-top:30px;"> 
                                        <div class="col-sm-12 col-md-6 col-lg-6">      
                                              <a href="#" class="btn  btn-success" data-toggle="collapse" aria-expanded="true" id="Top5BuyersUI">Add / Edit Top 5 Buyers</a>                                            
                                        </div>                                       
                                    </div>     
                                    <!-- end: Revenue Contribution by Buyer Type/ Segment /Distribution channel -->
                                    
                                    <!-- start: Top 5 Buyers -->
                                    <div class="=row">
                                        <h3 class="text-primary">Top 5 Buyers</h3>
                                        <table class="table table-striped table-hover" id="top5buyerstable">
                                              <thead>
                                                <tr>                                                
                                                  <th>Company Name
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Customer_Name__c.inlineHelpText}" />       
                                                          </th>
                                                  <th>% 
                                                         <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Percent__c.inlineHelpText}" />       
                                                  
                                                         </th>
                                                  <th>Credit Term(Days)
                                                        <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Credit_Term_Days__c.inlineHelpText}" />      
                                                  
                                                  </th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                             
                                              </tbody>
                                        </table>                                    
                                    </div>
                                    
                                    <apex:PageBlock mode="view" id="top5buyernoteBlock">                                    
                                        <apex:PageBlockSection columns="1" id="top5buyernoteSection">
                                            <apex:inputfield value="{!companyprofile.Top5BuyerNote__c}" styleclass="form-control" style="width:50%;" />
                                        </apex:PageBlockSection>                                        
                                    </apex:PageBlock>
                                    
                                    <!-- <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="form-group " >
                                            <label for="Buyer_Note__c" class="col-lg-12 col-md-12  control-label" style="text-align:left;">{!$ObjectType.CompanyProfile__c.fields.Buyer_Note__c.label} :</label>

                                        </div>
                                    </div> 
                                    <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="form-group">
                                            <div class="col-lg-12 col-md-12 outputText">
                                                <apex:outputField value="{!CompanyProfile.Buyer_Note__c}"  styleClass="form-control input-medium" id="Buyer_Note__c" />      
                                            </div>
                                        </div>
                                    </div> -->
                                    <!-- end: Top 5 Buyers -->
                                    
                                    <!-- start: Major raw material -->
                                    <div class="row" style="margin-top:30px;">
                                        &nbsp;
                                    </div>
                                
                                       <div class="row" style="padding-bottom: 3px;"> 
                                        <div class="col-sm-12 col-md-6 col-lg-6">      
                                              <a href="#" class="btn  btn-success" data-toggle="collapse" aria-expanded="true" id="majorrawUI">Add / Edit Major raw Material</a>                                            
                                        </div>                                       
                                    </div>             
                                     <div class="=row">
                                        <h3 class="text-primary">Major raw material</h3>                                        
                                        <table class="table table-striped table-hover " id="majorrawtable">
                                             <thead>
                                                 <tr>                                                
                                                  <th rowspan="2">Supplier Type
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="Supplier {!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.DataType__c.inlineHelpText}" />       
                                                          
                                                  
                                                  </th>
                                                  <th rowspan="2">CCY
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.CCY__c.inlineHelpText}" />       
                                                          
                                                  </th>
                                                  <th rowspan="2">Country
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Country__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th rowspan="2">%
                                                      <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Percent__c.inlineHelpText}" />       
                                    
                                                      </th>
                                                  <th rowspan="2">Estimate No. of Suppliers
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.EstimateNo__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th rowspan="2">Method of Payment
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.Method__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th colspan="2">Credit Term</th>
                                                </tr>
                                                <tr>
                                                  <th>From (Days)
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.FromDays__c.inlineHelpText}" />       
                                    
                                                  </th>
                                                  <th>To (Days)
                                                     <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.AcctPlanSupplierOrBuyer__c.Fields.ToDays__c.inlineHelpText}" />       
                                    
                                                     </th>
                                                </tr>
                                              </thead>
                                              <tbody> 

                                            
                                                
                                                
                                              </tbody>
                                        </table>                                    
                                    </div>  
                                    
                                    <div class="row" style="padding-bottom: 3px;margin-top:30px;"> 
                                        <div class="col-sm-12 col-md-6 col-lg-6">      
                                              <a href="#" class="btn  btn-success" data-toggle="collapse" aria-expanded="true" id="Top5SuppliersUI">Add / Edit Top 5 Suppliers</a>                                            
                                        </div>                                       
                                    </div>     
                                    <!-- end: Major raw material -->
                                    
                                    <!-- start: Top 5 Suppliers -->
                                    <div class="row">
                                        <h3 class="text-primary">Top 5 Suppliers</h3>
                                        <table class="table table-striped table-hover" id="top5supplierstable">
                                              <thead>
                                                <tr>                                                
                                                  <th>Company Name
                                                  <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Customer_Name__c.inlineHelpText}" />       
                                                          </th>
                                                  <th>% 
                                                         <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Percent__c.inlineHelpText}" />       
                                                  
                                                         </th>
                                                  <th>Credit Term(Days)
                                                        <span class="glyphicon glyphicon-question-sign" id="bootstrap-tooltip" 
                                                     data-toggle="tooltip"
                                                     data-delay='{"show":"0", "hide":"100"}'
                                                     data-animation="false"
                                                     data-placement="bottom" 
                                                     title="{!$ObjectType.Account_Plan_Company_Top_5__c.Fields.Credit_Term_Days__c.inlineHelpText}" />      
                                                   
                                                  </th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                               
                                              </tbody>
                                        </table>                                    
                                    </div>
                                    
                                    <apex:PageBlock mode="view" id="top5suppliernoteBlock">                                     
                                        <apex:PageBlockSection columns="1" id="top5suppliernoteSection">
                                            <apex:inputfield value="{!companyprofile.Top5SupplierNote__c}" styleclass="form-control" style="width:50%;" />
                                        </apex:PageBlockSection>                                        
                                    </apex:PageBlock>
                                    
                                    <!--DA <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="form-group " >
                                            <label for="Supplier_Note__c" class="col-lg-12 col-md-12  control-label" style="text-align:left;">{!$ObjectType.CompanyProfile__c.fields.Supplier_Note__c.label} :</label>

                                        </div>
                                    </div> 
                                    <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="form-group">
                                            <div class="col-lg-12 col-md-12 outputText">
                                                <apex:outputField value="{!CompanyProfile.Supplier_Note__c}"  styleClass="form-control input-medium" id="Supplier_Note__c" />      
                                            </div>
                                        </div>
                                    </div> -->
                                    <!-- end: Top 5 Suppliers -->   

                                 </fieldset>                                
                            </div>
                        </div>  
                        <!-- /Section 3 --> 
                        <!-- /Section 4 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{!IF(isMiniView || ISDisabled,'none','')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%; display:{!IF(isMiniView,'none','')};">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse4" class="navbar-brand navbar-foundation-logo collapsed">
                                       Customer Strategy
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse4" style="display:{!IF(isMiniView || ISDisabled ,'none','')};">            
                            <div class="card-detail" >
                            
                                <fieldset>
                                    
                                    <div class="row">                                
                                                                        
                                        <apex:PageBlock mode="view" id="customerstrategyBlock"> 
                                        
                                            <apex:PageBlockSection columns="1" id="customerstrategySection">
                                                <apex:inputfield value="{!companyprofile.CompanyStrategy__c}"  styleclass="form-control"/>
                                                <!--DA <apex:PageBlockSectionItem ></apex:PageBlockSectionItem> -->
                                            </apex:PageBlockSection>
                                            
                                        </apex:PageBlock>
                                        
                                    </div>
                                    
                                </fieldset>
                                
                            </div>
                        </div>                      
                        <!-- /Section 4 -->
                        
                        <!-- /Section 5 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{!IF(isMiniView || isDisabled,'none','')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%; display:{!IF(isMiniView,'none','')};">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse5" class="navbar-brand navbar-foundation-logo collapsed">
                                       Customer 5 Forces Model
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse5" style="display:{!IF(isMiniView || isDisabled,'none','')};">            
                            <div class="card-detail" >
                            
                                <fieldset>
                                    
                                    <div class="row">                                   
                                
                                       <apex:PageBlock mode="edit" id="forcemodel">   
                                            <apex:PageBlockSection columns="1"  id="forcemodelSection">
                                                
                                                <apex:inputfield value="{!companyprofile.BargainingPowerOfSupplier__c}" styleClass="form-control" style="width:300px;"/>
                                               
                                                <apex:inputfield value="{!companyprofile.BargainingPowerOfSupplierDescription__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.BargainingPowerOfBuyer__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.BargainingPowerOfBuyerDescription__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.BarrierOfNewEntrant__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.BarrierOfNewEntrantDescription__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.ThreatOfSubstituteProduct__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.ThreatOfSubstituteProductDescription__c}"  styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.IndustryCompetition__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.IndustryCompetitionDescription__c}" styleclass="form-control input-medium"  />
                                                
                                            </apex:PageBlockSection>
                                        </apex:PageBlock>
                                        
                                    </div>

                                </fieldset>
                                
                            </div>
                        </div>                      
                        <!-- /Section 5 -->
                        
                        <!-- /Section 6 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{!IF(isMiniView || isDisabled,'none','')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%; display:{!IF(isMiniView,'none','')};">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse6" class="navbar-brand navbar-foundation-logo collapsed">
                                       Key Success Factors / Competitive Advantages
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse6" style="display:{!IF(isMiniView || isDisabled,'none','')};">            
                            <div class="card-detail">
                            
                                <fieldset>
                                
                                    <div class="row">
                                                                               
                                        <apex:PageBlock mode="view" id="factorsBlock"> 
                                        
                                            <apex:PageBlockSection columns="1" id="factorsSection">
                                                <apex:inputfield value="{!companyprofile.FactorType1__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.FactorType1Description__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.FactorType2__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.FactorType2Description__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.FactorType3__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.FactorType3Description__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.FactorType4__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.FactorType4Description__c}" styleclass="form-control input-medium"  />
                                                
                                                <apex:inputfield value="{!companyprofile.FactorType5__c}" styleClass="form-control" style="width:300px;"/>
                                                <apex:inputfield value="{!companyprofile.FactorType5Description__c}" styleclass="form-control input-medium"  />
                                                <apex:PageBlockSectionItem ></apex:PageBlockSectionItem>
                                            </apex:PageBlockSection>
                                            
                                        </apex:PageBlock>
                                        
                                    </div>
                                    
                                </fieldset>
                                
                            </div>
                        </div>                      
                        <!-- /Section 6 -->
                        <!-- /Section 7 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{!IF(isMiniView || isDisabled,'none','')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%; display:{!IF(isMiniView,'none','')};">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse7" class="navbar-brand navbar-foundation-logo collapsed">
                                       Financial Highlight - Individual
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse7" style="display:{!IF(isMiniView || isDisabled,'none','')};">            
                            <div class="card-detail" >
                            
                                <fieldset>
                                    
                                    <div class="row">
                                                            
                                        <apex:PageBlock mode="view" id="financialHighlightBlock">                                   
                                            <apex:PageBlockSection columns="1" id="financialhighlightSection">
                                                <apex:inputfield value="{!companyprofile.FinancialHighlight__c}" />
                                                
                                            </apex:PageBlockSection>                                        
                                        </apex:PageBlock>  
                                        
                                    </div>                                      
                                        
                                </fieldset>
                                
                            </div>
                        </div>                      
                        <!-- /Section 7 -->

                          <!-- /Section 8 -->
                        <header class="navbar navbar-default navbar-branded clear-both" role="banner" style="display:{!IF(isMiniView || isDisabled,'none','')};">
                            <div class="panel-heading" style="float:left; clear:both; width:100%; display:{!IF(isMiniView,'none','')};">
                                <div class="navbar-header" style="float:left;">
                                    <a data-toggle="collapse" aria-expanded="false"
                                       href="#collapse8" class="navbar-brand navbar-foundation-logo collapsed">
                                      TMB Business
                                    </a>
                                </div>
                            </div>
                        </header>
                                    
                        <div class="card collapse " id="collapse8" style="display:{!IF(isMiniView || isDisabled,'none','')};">            
                            <div class="card-detail" >
                            
                                <fieldset>
                                    
                                    <div class="row">
                                                            
                                        <apex:PageBlock mode="view" id="TMBBusinessHighlightBlock">                                   
                                            <apex:PageBlockSection columns="1" id="TMBBusinesshighlightSection">
                                                <apex:inputfield value="{!companyprofile.TMB_Business__c}" />
                                            </apex:PageBlockSection>                                        
                                        </apex:PageBlock>  
                                        
                                    </div>                                      
                                        
                                </fieldset>
                                
                            </div>
                        </div>                      
                        <!-- /Section 8 -->


                                                </apex:pageBlock>                          
                 </apex:form>
             </div>
                                                
                                                <div class="bootstrap-sf1">                                  
          <!-- Modal -->
                <div  class="modal fade modal-fullscreen force-fullscreen"  id="frmModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-bottom: 30px;margin-top: 45px;">
                  <div class="modal-dialog" style="width:100%;height:95%;" >
                    <div class="modal-content" style="width:100%;height:95%;" >
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel"> </h4>
                      </div>
                      <div class="modal-body">
                          <iframe id="modalIframe" src="#" width="100%" height="400px" frameborder="0" allowtransparency="true"></iframe>  
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                       
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>  <!-- /.modal-dialog -->
                </div>
              </div>    
                                                
                        
          <apex:remoteObjects jsNamespace="JSObjects"> 
            <apex:remoteObjectModel name="AcctPlanContribution__c" fields="Id" jsShorthand="contribute">
                  <apex:remoteObjectField name="Account_Plan_Company_Profile__c" jsShorthand="companyprofile" />
                <apex:remoteObjectField name="Name" jsShorthand="name" /> 
                <apex:remoteObjectField name="AccountPlanGroupProfile__c" jsShorthand="groupprofile" />  
                <apex:remoteObjectField name="BusinessUnit__c" jsShorthand="businessunit" />  
                 <apex:remoteObjectField name="EBITDAContributionPercent__c" jsShorthand="ebitda" />
                 <apex:remoteObjectField name="Regional__c" jsShorthand="regional" />
                <apex:remoteObjectField name="RevenueContributionPercent__c" jsShorthand="revenuepercent" />
                  <apex:remoteObjectField name="RevenueContributionType__c" jsShorthand="revenuetype" />   
            </apex:remoteObjectModel>
                                                
              <apex:remoteObjectModel name="AcctPlanSupplierOrBuyer__c" fields="Id" jsShorthand="supplierorbuyer">
                  <apex:remoteObjectField name="Percent__c" jsShorthand="percent" />
                <apex:remoteObjectField name="Name" jsShorthand="name" /> 
                 <apex:remoteObjectField name="Account_Plan_Company_Profile__c" jsShorthand="companyprofile" />
                 <apex:remoteObjectField name="CCY_Short_Name__c" jsShorthand="ccy" />
                 <apex:remoteObjectField name="Company_Name__c" jsShorthand="companyname" />
                <apex:remoteObjectField name="Country_Name__c" jsShorthand="country" />
                  <apex:remoteObjectField name="Credit_Term__c" jsShorthand="creditterm" />
                   <apex:remoteObjectField name="DataType__c" jsShorthand="datatype" />  
                 <apex:remoteObjectField name="EstimateNo__c" jsShorthand="estimateNo" />
                 <apex:remoteObjectField name="FromDays__c" jsShorthand="fromdays" />
                <apex:remoteObjectField name="Method__c" jsShorthand="method" />
                  <apex:remoteObjectField name="Segment__c" jsShorthand="segment" />
                  <apex:remoteObjectField name="ToDays__c" jsShorthand="todays" />
            </apex:remoteObjectModel>                                   
               
              <apex:remoteObjectModel name="Account_Plan_Company_Top_5__c" fields="Id" jsShorthand="topfive">
                  <apex:remoteObjectField name="Percent__c" jsShorthand="percent" />
                <apex:remoteObjectField name="Name" jsShorthand="name" /> 
                 <apex:remoteObjectField name="Account_Plan_Company_Profile__c" jsShorthand="companyprofile" />
                 <apex:remoteObjectField name="Customer_Name__c" jsShorthand="customername" />
                  <apex:remoteObjectField name="Credit_Term_Days__c" jsShorthand="creditterm" />
                  <apex:remoteObjectField name="Top_5_Types__c" jsShorthand="toptype" />
            </apex:remoteObjectModel>
             </apex:remoteObjects>                                    
            <apex:includeScript value="{!$Resource.AccountPlan_JqueryScript}"/>
            
            <apex:includeScript value="{!$Resource.AccountPlan_Bootstrap}"/>
            
            <apex:includeScript value="{!$Resource.AccountPlan_Mustache}"/>
            
            <apex:includeScript value="/support/console/22.0/integration.js"/>
            <script type="text/javascript">
                   
                // Prevent Config
                var $j = jQuery.noConflict();          
                var contributeobj = new JSObjects.contribute();
                var supplierOrBuyerobj = new JSObjects.topfive();
                var distributionobj = new JSObjects.supplierorbuyer();
                var companyprofile = '{!CompanyID}';

                function checkIshasValue(item) {
                                       var msg = item.value;
                                        $j(item).removeClass('info');
                                        $j(item).removeClass('danger');
                                        //$j(item).removeClass('success');
                                       if(msg !='' && msg != null && msg !='0' && msg !=0){
                                           //$j(item).addClass('success');
                                       }else{
                                          $j(item).addClass('danger'); 
                                       }
                                    }

                function numberWithCommas(x) {
                    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                }

                             function commaSeparateNumber(val){
                while (/(\d+)(\d{3})/.test(val.toString())){
                  val = val.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
                }
                return val;
              }

                
                function clearIframe(){
                    $j("#modalIframe").attr('src','');
                }                

                //query contribution event 
                contributeobj.getData = function(callback){
                    contributeobj.retrieve({
                        
                         where: {
                              Account_Plan_Company_Profile__c  : { eq: companyprofile }
                          },
                        orderby: [ {RevenueContributionPercent__c: "DESC"},{Name: "ASC"} ]                   
                    }
                    , function(err, records){
                            if(err) alert(err.message);
                            else {
                                 
                                                  
                                callback(records);
                            };
                        });
                }
                
                
                
            //query supplier or buyer event
                supplierOrBuyerobj.getData = function(callback){
                    supplierOrBuyerobj.retrieve({
                        
                         where: {
                             // and: {
                             Account_Plan_Company_Profile__c  : { eq: companyprofile }
                                 //  ,Segment__c: { eq: 'Top 5 Buyers' }  
                                 // }
                          },
                        orderby: [ {Percent__c : "DESC"},{Name: "ASC"} ]                   
                    }
                    , function(err, records){
                            if(err) alert(err.message);
                            else {
                                 
                                                  
                                callback(records);
                            };
                        });
                }
                
               //query distribution and major raw materials
                distributionobj.getData = function(callback){
                    distributionobj.retrieve({
                        
                         where: {
                             //and: {
                             Account_Plan_Company_Profile__c  : { eq: companyprofile }
                             //    ,Segment__c: { eq: 'Distribution' }  
                             //   }
                          },
                        orderby: [ {Percent__c : "DESC"},{Name: "ASC"} ]                   
                    }
                    , function(err, records){
                            if(err) alert(err.message);
                            else {
                                 
                                                  
                                callback(records);
                            };
                        });
                } 
                
                
                 
                
                //Contribute Callback
                var contributeCallback =  function(result){
                    
                    
                    var contributetableTrTemplate = "<tr>" +
                                    "   <td data-id='{{Id}}'>{{revenuetype}}</td>"+
                                    "   <td>{{{name}}}</td>"+
                                    "   <td>{{revenuepercent}}%</td>"+
                                    "   <td>{{ebitda}}%</td>"+
                                    "</tr>";
                    var contributetableTrTotalTemplate = "<tr class='info endRow' style='border-bottom:none;'>" +
                                    "   <td data-id='{{Id}}' class='text-center' style='vertical-align: middle;'></td>"+
                                    "   <td data-id='{{Id}}' class='text-center' style='vertical-align: middle;'>Total</td>"+
                                    "   <td class='text-center' style='vertical-align: middle;'>{{revenuepercenttotal}}%</td>"+
                                    "   <td class='text-center' style='vertical-align: middle;'>{{ebitdatotal}}%</td>"+
                                    "</tr>"; 
                    var mandatoryDiv = "<p id='contributeNotify' class='bg-danger text-center' style=' float: left;padding: 8px;border: 1px solid #E28888;margin-left:10px;'>"+
                                                 //"There must be at least one record"+
                                                 "{!msgTableMandatory}"+
                                             "</p>";
                    
                    var contributetable = $j('#contributetable tbody');
                    var mandatoryblock = $j('#mandatoryedittable');
                    var servicproductList= new Array();
                    var regionalList= new Array();
                    var businessunitList= new Array();
                            if(result.length ==0 ){
                                mandatoryblock.append(mandatoryDiv); 
                                
                           }
                         for (index = 0; index < result.length; ++index) {
                            var record = result[index];
                                 
                                     var obj  = {
                                            Id : record.get("Id"),
                                            name : record.get("name"),
                                            companyprofile : record.get("companyprofile"),
                                            groupprofile : record.get("groupprofile"),
                                            businessunit : record.get("businessunit"),
                                            ebitda : record.get("ebitda"),
                                            regional : record.get("regional"),
                                           revenuepercent : record.get("revenuepercent"),
                                          
                                        };
                             
                                    
                             var replacename= record.get("revenuetype");
                             obj.revenuetype = replacename.replace("amp;", "");
                            
                             if(obj.revenuetype == 'Contribution by business unit'){
                                 businessunitList.push(obj); 
                             }else if (obj.revenuetype =='Contribution by regional'){
                                 regionalList.push(obj);
                             }else if (obj.revenuetype =='Contribution by service & product'){
                                 servicproductList.push(obj);
                             }
                            
                                                           
                      } 
                
                     var serviceproductTotal ={
                                        Id : 'capitalloanserviceproduct-total',
                                        revenuepercenttotal :0,
                                        ebitdatotal : 0
                                };
                    var businessunitTotal ={
                                        Id : 'businessunit-total',
                                        revenuepercenttotal :0,
                                        ebitdatotal : 0
                                };
                    var regionalTotal ={
                                        Id : 'regional-total',
                                        revenuepercenttotal :0,
                                        ebitdatotal : 0
                                };
                    
                    
 //Service Product
                             for (index = 0; index < servicproductList.length; ++index) {
                                    var record = servicproductList[index];
                                 if(index!=0){
                                    record.revenuetype ='';
                                     }
                                
                                 
                                 serviceproductTotal.revenuepercenttotal += record.revenuepercent;
                                 record.revenuepercent = parseFloat(Math.round(record.revenuepercent * 100) / 100).toFixed(2);
                                 if(record.ebitda >0 || record.ebitda !=null){
                                      serviceproductTotal.ebitdatotal += record.ebitda;
                                      record.ebitda = parseFloat(Math.round(record.ebitda * 100) / 100).toFixed(2);
                                     
                                     }else{
                                         
                                         record.ebitda =parseFloat(Math.round(0* 100) / 100).toFixed(2);
                                  }
                                
                                 
                                 contributetable.append(Mustache.render(contributetableTrTemplate, record)); 
                                 } 
                    
             
                                if(servicproductList.length >0){
                                     var ebidtatotal =  parseFloat(Math.round( serviceproductTotal.ebitdatotal * 100) / 100).toFixed(2);
                                    serviceproductTotal.ebitdatotal = ebidtatotal;
                                    
                                     var revenuetotal =   parseFloat(Math.round(serviceproductTotal.revenuepercenttotal  * 100) / 100).toFixed(2);
                                    serviceproductTotal.revenuepercenttotal = revenuetotal;
                                    
                                    if(serviceproductTotal.ebitdatotal =='NaN' || serviceproductTotal.ebitdatotal ==null){
                                        serviceproductTotal.ebitdatotal = parseFloat(Math.round(0* 100) / 100).toFixed(2);
                                        }
                                        
                                    contributetable.append(Mustache.render(contributetableTrTotalTemplate, serviceproductTotal)); 
                                    }
                    
                    //business unit
                                    for (index = 0; index < businessunitList.length; ++index) {
                                    var record = businessunitList[index];
                                  if(index!=0){
                                    record.revenuetype ='';
                                     }
                                 businessunitTotal.revenuepercenttotal += record.revenuepercent;
                                 record.revenuepercent = parseFloat(Math.round(record.revenuepercent * 100) / 100).toFixed(2);
                                        
                                 if(record.ebitda >0 || record.ebitda !=null){
                                      businessunitTotal.ebitdatotal += record.ebitda;
                                      record.ebitda =parseFloat(Math.round(record.ebitda* 100) / 100).toFixed(2);
                                     }else{
                                         record.ebitda =parseFloat(Math.round(0* 100) / 100).toFixed(2);
                                  }
                                        
                                 contributetable.append(Mustache.render(contributetableTrTemplate, record));   
                                 }
                    
                     if(businessunitList.length >0){
                        var ebidtatotal =  parseFloat(Math.round(businessunitTotal.ebitdatotal * 100) / 100).toFixed(2);
                        businessunitTotal.ebitdatotal = ebidtatotal;
                         var revenuetotal =  parseFloat(Math.round(businessunitTotal.revenuepercenttotal * 100) / 100).toFixed(2);
                        businessunitTotal.revenuepercenttotal = revenuetotal;
                         
                          if(businessunitTotal.ebitdatotal  =='NaN' || businessunitTotal.ebitdatotal ==null){
                                        businessunitTotal.ebitdatotal = parseFloat(Math.round(0* 100) / 100).toFixed(2);
                          }
                        contributetable.append(Mustache.render(contributetableTrTotalTemplate, businessunitTotal)); 
                    }       
                    
                    
                             for (index = 0; index < regionalList.length; ++index) {
                                    var record = regionalList[index];
                                  if(index!=0){
                                    record.revenuetype ='';
                                     }
                                 regionalTotal.revenuepercenttotal += record.revenuepercent;
                                 record.revenuepercent = parseFloat(Math.round(record.revenuepercent * 100) / 100).toFixed(2);
                                  
                                 if(record.ebitda >0 || record.ebitda !=null){
                                      regionalTotal.ebitdatotal += record.ebitda;
                                     record.ebitda = parseFloat(Math.round(record.ebitda * 100) / 100).toFixed(2);
                                  
                                     }else{
                                         record.ebitda = parseFloat(Math.round(0* 100) / 100).toFixed(2);
                                  }
                                 contributetable.append(Mustache.render(contributetableTrTemplate, record));   
                                 } 
                    if(regionalList.length >0){
                          var ebidtatotal =  parseFloat(Math.round(regionalTotal.ebitdatotal * 100) / 100).toFixed(2);
                        regionalTotal.ebitdatotal = ebidtatotal;
                         var revenuetotal =  parseFloat(Math.round(regionalTotal.revenuepercenttotal * 100) / 100).toFixed(2);
                        regionalTotal.revenuepercenttotal = revenuetotal;
                        
                         if(regionalTotal.ebitdatotal =='NaN' ||regionalTotal.ebitdatotal ==null){
                                        regionalTotal.ebitdatotal = parseFloat(Math.round(0* 100) / 100).toFixed(2);
                                        }
                     contributetable.append(Mustache.render(contributetableTrTotalTemplate, regionalTotal)); 
                   }
                    }
                
                
                
                
                
                 //Top5Buyer Callback
                var top5buyerCallback =  function(result){
                    
                     var top5tableTrTemplate = "<tr>" +
                                    "   <td data-id='{{Id}}'>{{{customername}}}</td>"+
                                    "   <td>{{percent}}%</td>"+
                                    "   <td>{{creditterm}}</td>"+
                                    "</tr>";

                    
                    var top5buyerstable = $j('#top5buyerstable tbody'); 
                     var top5supplierstable = $j('#top5supplierstable tbody');  
                     
                             for (index = 0; index < result.length; ++index) {
                                    var record = result[index];
                                            
                                 
                                 var obj  = {
                                            Id : record.get("Id"),
                                            companyname  : record.get("companyname"),
                                            name  : record.get("name"),
                                            percent : record.get("percent"),
                                            toptype : record.get("toptype"),
                                            customername  : record.get("customername"),
                                            creditterm : record.get("creditterm")
                                        };
        
                                 if(record.get("percent") !=null && record.get("percent") >0){
                                     var percentage = record.get("percent");
                                     obj.percent = parseFloat(Math.round(percentage * 100) / 100).toFixed(2);
                                 }
                                 if(record.get("toptype") == 'Buyers'){
                                 top5buyerstable.append(Mustache.render(top5tableTrTemplate, obj)); 
                                 }
                                 if(record.get("toptype") == 'Suppliers'){
                                 
                                  top5supplierstable.append(Mustache.render(top5tableTrTemplate, obj)); 
                                 }
                                
                                 
                            }
                    }
                
                
                
                 //Distribution - major raw materials Callback
                var distributioncallback = function(result){
                    var distributiontable = $j('#distributiontable tbody');  
                     var majorrawtable= $j('#majorrawtable tbody');  
                     
                    var distributeTotal ={
                                        Id : 'distribute-total',
                                        percent :0,
                                        estimateNo : 0
                                };
                    var materialTotal ={
                                        Id : 'material-total',
                                        percent :0,
                                        estimateNo : 0
                                };
                     var distributeTrTemplate = "<tr>" +
                                    "   <td data-id='{{Id}}'>{{datatype}}</td>"+
                                    "   <td>{{ccy}}</td>"+
                                    "   <td>{{country}}</td>"+
                                    "   <td>{{percent}}%</td>"+
                                    "   <td>{{estimateNo}}</td>"+
                                    "   <td>{{method}}</td>"+
                                    "   <td>{{fromdays}}</td>"+
                                    "   <td>{{todays}}</td>"+
                                    "</tr>";
                    var distributeTrTotalTemplate = "<tr class='info endRow' style='border-bottom:none;'>" +
                                    "   <td data-id='{{Id}}' colspan='3' class='text-center' style='vertical-align: middle;'>Total</td>"+
                                    "   <td class='text-center' style='vertical-align: middle;'>{{percent}}%</td>"+
                                    "   <td class='text-center' style='vertical-align: middle;'>{{estimateNo}}</td>"+
                                    "   <td data-id='{{Id}}' colspan='3' class='text-center' style='vertical-align: middle;'>&nbsp;</td>"+
                                    "</tr>"; 
                    
                    for (index = 0; index < result.length; ++index) {
                                    var record = result[index];
                                            
                                 
                                 var obj  = {
                                            Id : record.get("Id"),
                                            companyname  : record.get("companyname"),
                                            percent : record.get("percent"),
                                            segment : record.get("segment"),
                                            ccy  : record.get("ccy"),
                                            country : record.get("country"),
                                            estimateNo  : record.get("estimateNo"),
                                            method : record.get("method"),
                                            fromdays   : record.get("fromdays"),
                                            todays  : record.get("todays"),
                                            datatype   : record.get("datatype"),
                                            creditterm : record.get("creditterm")
                                        };
                        
                                if(record.get("percent") !=null && record.get("percent") >0){
                                      var percentage = record.get("percent");
                                     obj.percent = parseFloat(Math.round(percentage * 100) / 100).toFixed(2);
                                 
                                  }
                                
                                if(record.get("segment") == 'Distribution'){
                                    distributeTotal.percent += record.get("percent");
                                   
                                     if(record.get("estimateNo") !=null && record.get("estimateNo") !=0){
                                        var estimate =  numberWithCommas(record.get("estimateNo"));
                                        obj.estimateNo =estimate;  
                                        distributeTotal.estimateNo += record.get("estimateNo"); 
                                     }
                                 distributiontable.append(Mustache.render(distributeTrTemplate, obj)); 
                                 }
                                 if(record.get("segment") == 'Major raw material'){ 
                                   materialTotal.percent += record.get("percent");
                                     if(record.get("estimateNo") !=null && record.get("estimateNo") !=0){
                                        var estimate =  numberWithCommas(record.get("estimateNo"));
                                        obj.estimateNo =estimate;  
                                        materialTotal.estimateNo += record.get("estimateNo"); 
                                     }
                                  majorrawtable.append(Mustache.render(distributeTrTemplate, obj)); 
                                 } 
                        
                        }
                        if(distributeTotal.percent>0){
                            var dispercent = distributeTotal.percent;
                            var disestimate = distributeTotal.estimateNo;
                            distributeTotal.estimateNo = numberWithCommas(disestimate);
                            distributeTotal.percent =  parseFloat(Math.round(dispercent * 100) / 100).toFixed(2);                           
                            distributiontable.append(Mustache.render(distributeTrTotalTemplate, distributeTotal)); 
                          }  
                        if(materialTotal.percent>0){
                            var materialpercent = materialTotal.percent;
                             var materialestimate = materialTotal.estimateNo;
                            materialTotal.estimateNo = numberWithCommas(materialestimate);
                            materialTotal.percent =  parseFloat(Math.round(materialpercent * 100) / 100).toFixed(2); 
                            majorrawtable.append(Mustache.render(distributeTrTotalTemplate, materialTotal)); 
                          }  
                    }
                
                
                
                
                
                
                // Ready Event  
                $j(document).ready( function () {  
                    clearIframe(); 
                    $j('[data-toggle="tooltip"]').tooltip();  
                     setTitle();
           //domestic callback;
              if(companyprofile !=null && companyprofile !=''){      
            contributeobj.getData(contributeCallback);
                    //top5callback
            supplierOrBuyerobj.getData(top5buyerCallback);
                    //Distribution callback
            distributionobj.getData(distributioncallback);
                   } 
             $j("#contributeUI").on('click',function(event){
                        
                        event.preventDefault();
                        var mandatoryblock = $j('#mandatoryedittable');
                        mandatoryblock.empty();
                        $j('#modalIframe').attr("src",'/apex/RevenueContributionEditable?companyid='+companyprofile);                 
                        
                        $j('#frmModel').modal({show:true});
                        
                    }); 
                    
                    $j('#frmModel').on('show.bs.modal', function () {
                        $j(this).find('.modal-body').css({                        
                            // 'max-height':'800px'
                        });
                    });
                    
             $j("#distributionUI").on('click',function(event){
                        
                        event.preventDefault();
                        var mandatoryblock = $j('#mandatoryedittable');
                        mandatoryblock.empty();
                        $j('#modalIframe').attr("src",'/apex/SupplierOrBuyerEditable?companyid='+companyprofile+'&segment=Distribution');                 
                        
                        $j('#frmModel').modal({show:true});
                    }); 
                    
                          
                 
              $j("#majorrawUI").on('click',function(event){
                        
                        event.preventDefault();
                        var mandatoryblock = $j('#mandatoryedittable');
                        mandatoryblock.empty();
                        $j('#modalIframe').attr("src",'/apex/SupplierOrBuyerEditable?companyid='+companyprofile+'&segment=Majorraw');                 
                        
                        $j('#frmModel').modal({show:true});
                    }); 
                    
                    $j('#frmModel').on('show.bs.modal', function () {
                        $j(this).find('.modal-body').css({                        
                            // 'max-height':'800px'
                        });
                    }); 
                    
               $j("#Top5BuyersUI").on('click',function(event){
                        
                        event.preventDefault();
                        var mandatoryblock = $j('#mandatoryedittable');
                        mandatoryblock.empty();
                        $j('#modalIframe').attr("src",'/apex/Top5Editable?companyid='+companyprofile+'&segment=Buyers');                 
                        
                        $j('#frmModel').modal({show:true});
                    }); 
                    
                    $j('#frmModel').on('show.bs.modal', function () {
                        $j(this).find('.modal-body').css({                        
                            // 'max-height':'800px'
                        });
                    }); 
                    
                $j("#Top5SuppliersUI").on('click',function(event){
                        
                        event.preventDefault();
                        var mandatoryblock = $j('#mandatoryedittable');
                        mandatoryblock.empty();
                        $j('#modalIframe').attr("src",'/apex/Top5Editable?companyid='+companyprofile+'&segment=Suppliers');                 
                        
                        $j('#frmModel').modal({show:true});
                    }); 
                    
                    $j('#frmModel').on('show.bs.modal', function () {
                        $j(this).find('.modal-body').css({                        
                            // 'max-height':'800px'
                        });
                    });     
        
                   $j('#frmModel').on('hidden.bs.modal', function (e) {
                          // do something...
                       clearIframe(); 
                       if(companyprofile !=null && companyprofile !=''){    
                         var contributetable = $j('#contributetable tbody');
                         var distributiontable = $j('#distributiontable tbody');
                         var majorrawtable = $j('#majorrawtable tbody');
                        var top5buyerstable = $j('#top5buyerstable tbody');
                        var top5supplierstable = $j('#top5supplierstable tbody');
                            contributetable.hide();
                            distributiontable.hide();
                            majorrawtable.hide();
                            top5buyerstable.hide();
                            top5supplierstable.hide();
                        
                           contributetable.empty();
                          distributiontable.empty();
                            majorrawtable.empty();
                            top5buyerstable.empty();
                            top5supplierstable.empty();
                        
                         contributeobj.getData(contributeCallback);
                        supplierOrBuyerobj.getData(top5buyerCallback);
                         distributionobj.getData(distributioncallback);
                        
                        contributetable.show();
                        distributiontable.show();
                        majorrawtable.show(); 
                        top5buyerstable.show();
                        top5supplierstable.show();
                           }
                    });
            
            //end callback
                });                 
                  
        </script>
<apex:includeScript value="/support/console/22.0/integration.js"/>
 <script type="text/javascript">
        //Sets the title of the current tab to "Case Transactions Detail"
/*window.onload = function setTitleConsole(){
            setTitle();
        }*/
        //Sets the title of the current tab to "Case Transactions Detail"
        function setTitle() {
            sforce.console.setTabTitle('Customer Profile');
        }

    
    </script>
    </body>

</apex:page>